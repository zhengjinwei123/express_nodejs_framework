/**
 * Created by zhengjinwei on 2015/12/29.
 * QQ:2538698032 weixin:bloodchilde
 * email:2538698032@qq.com
 */
var expressLoader = require("./lib/expressLoader.js");
var fileLoader = require("./lib/fileLoader.js");
var redisLoader = require("./lib/redisLoader/redisPool");


function component(opts) {
    this.opts = opts;
}

component.prototype.start = function (cb) {
    var express_loader = new expressLoader(this.opts);
    var file_loader = new fileLoader(this.opts);
    if (this.opts.redis.valid) {
        var redis_loader = new redisLoader(
            this.opts.redis.pool_count,
            this.opts.redis.port,
            this.opts.redis.host,
            this.opts.redis.password);

        var opts = this.opts;
        redis_loader.run(function (status) {
            if (status) {

                console.log("[redis-loader]", "redis connect to host:", opts.redis.host, " port:",opts.redis.port, " success");
            }
        });
    }

    express_loader.run();
    file_loader.run(function (status) {
        cb(status);
    });
};


module.exports = component;